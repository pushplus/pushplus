# 通过集简云发送企业微信应用消息

## 引言
　&emsp;&emsp;企业微信已修改了第三方应用的接入方式。原本通过简单的手动配置方式已无法正常发送消息，需要额外配置可信IP地址，且可信IP不可公用。新的方案需要通过接口授权的方式来实现企业微信中第三方应用的创建。目前pushplus官方还没有原生实现这种对接方式，但是可以通过集简云渠道来快速的配置来实现通过pushplus发送企业微信应用消息。

## 收费说明
　&emsp;&emsp;由于企业微信出台了【[面向服务商进行收费模式调整的说明](https://open.work.weixin.qq.com/wwopen/common/readDocument/38829)】，自2022年5月16日起，企业微信将面向服务商进行收费模式的调整。具体收费价格按照帐号数计算。

| 帐号数区间 | 基础帐号价格 | 互通帐号价格 |
| --- | --- | --- |
|1-5 | 5元/帐号/年 | 50元/帐号/年 |
|6-200| 4元/帐号/年| 40元/帐号/年 |
|201-500 | 3元/帐号/年| 30元/帐号/年 |
|501-1000 | 2元/帐号/年| 20元/帐号/年 |
|1001-10000 | 1元/帐号/年| 10元/帐号/年 |
|10001及以上| 面议| 面议|

- 企业微信中的一个员工代表一个帐号。

## 集简云简介
　&emsp;&emsp;集简云是一款超级软件连接器，通过集简云您无需任何开发就可以将pushplus与您在使用的内部与外部系统打通，例如CRM，数据库，邮件系统，短信系统，外呼电话系统，ERP财务系统等400多款软件系统。

## 使用步骤

#### 一. 访问集简云官网
打开[集简云官网](https://www.jijyun.cn/apps/),点击登录。登录后在数据流程中创建一个新的流程。
![](./images/jijyun1.jpg)

#### 二. 创建触发动作步骤
1. 在流程中选择webhook应用，触发动作为“当接收到数据时”。会获取到一个webhook的URL地址，这个地址保存下来，后续填写到pushplus的配置中。

![](./images/jijyun8.png)

2. 在pushplus微信公众号的菜单中点击“功能”->“个人中心”->"渠道配置",新增一个webhook渠道。
3. 在webhook渠道中“请求地址”填写上一步获取的webhook地址。“webhook”类型选择集简云。

![](./images/jijyun4.png)

4. 保存后在官网中发送一条测试数据。注意发送渠道选择刚刚配置的webhook渠道。

![](./images/jijyun3.jpg)

5. 发送成功后，集简云中就会获取到推送的数据格式，从而可以在字段匹配流程中使用请求的内容参数。

![](./images/jijyun6.png)

6. 在集简云中点击获取样本数据，就会收到样本数据。触发动作就配置好了。

![](./images/jijyun2.png)

#### 三、配置执行动作步骤
1. 然后在执行动作中选择应用“企业微信（代开发），执行动作是“发送文本信息给员工（基础账号）”。然后需要扫码将自己的企业微信中创建一个第三方应用。

![](./images/jijyun9.png)

2. 保存后进入字段匹配，企业员工Id可以填入@all，给全员发送。内容设置webhook推送的内容字段。

![](./images/jijyun7.png)

3. 然后可以在发送数据中进行测试，如果能够成功收到消息说明配置就正确了，保存流程即可。

### 四. 发送消息
现在只要在pushplus中正常调用接口，渠道选择自己创建的webhook，就可以正常在企业微信中收到消息了。

请求接口示例
- 请求地址：http://www.pushplus.plus/send/{token}
- 请求方式：POST
- 请求内容：

```
{
    "token":"{token},
    "title":"webhook标题",
    "content":"企业微信内容",
    "channel":"webhook",
    "webhook":"自定义的webhook编码"
}
```